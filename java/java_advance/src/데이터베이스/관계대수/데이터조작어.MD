### DML ë°ì´í„° ì¡°ì‘ì–´(Data Manipulation language)

```sql
/*í‚¤ì›Œë“œ ì •ë¦¬
í…Œì´ë¸”ì„ ë³µì‚¬í•˜ëŠ” SELECT
CREATE TABLE í…Œì´ë¸” ì´ë¦„(SELECT ì›í•˜ëŠ” ì†ì„± ì§€ì • FROM ê¸°ì¡´ í…Œì´ë¸”)
create table buytb12 (select * from buytbl);
*/ 

-- ì•„ë˜ ì¿¼ë¦¬ë¬¸ì€ ê¸°ì¡´ì— í…Œì´ë¸”ì—ì„œ ì¶”ì¶œí•´ì„œ ìƒˆë¡œìš´ í…Œì´ë¸”ì„ ë§Œë“ ê²ƒì´ë‹¤. 
select * from buytbl;
create table buytb12 (select * from buytbl);
create table buytbl3 (select num,userID,prodName from buytbl);
desc buytb12; -- ì´ê²ƒì€ ì˜¤ë¥˜ê°€ ëœ¬ë‹¤ í‚¤ê°’ì„ ì„¤ì •ì„ ë”°ë¡œ ì•ˆí•´ì£¼ì—ˆê¸° ë•Œë¬¸ì— 





```

<details>
<summary>ğŸGroup by ì ˆê³¼ having , ì§‘ê³„ í•¨ìˆ˜ğŸ    </summary>
<div markdown="1">

- Group ì ˆì„ ì´í•´í•´ì•¼ Joinì„ ì´í•´í•  ìˆ˜ ìˆë‹¤. 
- Group byì ˆì€ íˆ¬í”Œë³„ë¡œ ê·¸ë£¹í•‘ì„ í•œë‹¤.
- ê·¸ë£¹ë°”ì´ì ˆì´ ìˆìœ¼ë©´  ìœ ì €ë³„ë¡œ ì¶œë ¥ì´ ë˜ê³ 
- ê·¸ë£¹ë°”ì´ì ˆì´ ì—†ìœ¼ë©´ ì´ í‰ê· ì´ ë‚˜ì˜¨ë‹¤.
````SQL
 -- 1. buytbl í…Œì´ë¸”ì—ì„œ ì‚¬ìš©ìì•„ì´ë””ì™€ ì¬ê³ ìˆ˜ëŸ‰ì„ ì•„ì´ë”” ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬í•˜ì—¬ ì¶œë ¥ 
 select userid, amount from buytbl order by userid asc;
 
 select sum(amount) as ì´ê°œìˆ˜ from buytbl group by userid; -- ì´ê²Œ ë¬´ìŠ¨ì˜ë¯¸ì§€? 
 
 -- 2.ì „ì²´ êµ¬ë§¤ìê°€ êµ¬ë§¤í•œ ë¬¼í’ˆì˜ í‰ê· ì„ êµ¬í•˜ì—¬ ì¶œë ¥í•˜ì„¸ìš”.
 select userID, (amount) as 'êµ¬ë§¤ ë¬¼í’ˆ í‰ê· ' from buytbl group by userid;
 select userid, avg(amount) as 'êµ¬ë§¤ ë¬¼í’ˆ í‰ê· ' from buytbl;
 select userid, prodname, avg(amount) from buytbl group by userid,prodname; -- ì´ê²ƒì€ ì˜¤ë¥˜ê°€ ë‚œë‹¤.
 select * from buytbl;
 /*
 ê·¸ë£¹ë°”ì´ì ˆì´ ìˆìœ¼ë©´  ìœ ì €ë³„ë¡œ ì¶œë ¥ì´ ë˜ê³  
 ê·¸ë£¹ë°”ì´ì ˆì´ ì—†ìœ¼ë©´ ì´ í‰ê· ì´ ë‚˜ì˜¨ë‹¤. */
 ê°€ì¥ í° í‚¤ì™€ ê°€ì¥ ì¹¸ì€ í‚¤ì˜ íšŒì›ì˜ ì´ë¦„ê³¼ í‚¤ë¥¼ ì¶œë ¥í•´ë¼ 
 select name max(height), min(height) from usertbl group by name;
 select name, height from usertbl 
where 
height = (select max(height) from usertbl)
 or 
 height = (select min(height) from usertbl);
 
 -- 3. íœ´ëŒ€í°ì´ ìˆëŠ” ì‚¬ìš©ìì˜ ìˆ˜ë¥¼ ì¶œë ¥í•˜ì„¸ìš” : count();
 select * from usertbl;

 select count(*) from usertbl; -- ì „ì²´ íŠœí”Œ ì¹´ìš´íŠ¸

select count(mobile2) from usertbl; -- ì§€ì •í•œ ì¹¼ëŸ¼ ìˆ˜ ì¹´ìš´íŠ¸ ë‹¨ null ì œì™¸ 
 

````

<details>
<summary> ğŸhaving ì ˆğŸ </summary>
<div markdown="1">



```SQL
-- group byì˜ ì¡°ê±´ having 


-- 1. ì‚¬ìš©ì ë³„ ì´ êµ¬ë§¤ì•¡ ì¶œë ¥ buytbl
select * from buytbl;
select userid as 'ì‚¬ìš©ì',sum(price*amount) as 'ì´êµ¬ë§¤ì•¡'
from buytbl
group by userid;

-- 2. ì´ êµ¬ë§¤ì•¡ì´ 1000 ì´ìƒì¸ ì‚¬ìš©ìì—ê²Œë§Œ ì‚¬ì€í’ˆ ì¦ì • í•˜ë ¤ê³  í•œë‹¤.  
select * from buytbl;


select userid as 'ì‚¬ìš©ì',sum(price*amount) as 'ì´êµ¬ë§¤ì•¡'
from buytbl
where sum(price*amount)>1000
group by userid;
-- ì´ê²ƒì€ ì˜¤ë¥˜ê°€ ëœ¬ë‹¤ ì™œ? whereì ˆì—ëŠ” ì§‘ê³„í•¨ìˆ˜ê°€ ë“¤ì–´ê°ˆ ìˆ˜ê°€ ì—†ë‹¤.


select userid as 'ì‚¬ìš©ì',sum(price*amount) as 'ì´êµ¬ë§¤ì•¡'
from buytbl
group by userid
having sum(price*amount)>1000;
-- ì´ê²Œ ì •ë‹µì´ë‹¤.

----------------------------------------------------

-- 1.ì´ êµ¬ë§¤ì•¡ì´ 1000 ì´ìƒì¸ ì‚¬ìš©ìì—ê²Œë§Œ ì‚¬ì€ í’ˆ ì¦ì • í•˜ë ¤ê³  í•œë‹¤. ì´ ì¡°ê±´ì—ì„œ í•´ë‹¹í•˜ëŠ” ì‚¬ìš©ì ì•„ì´ë””ì™€ ì´ êµ¬ë§¤ì•¡ì„ ì´ êµ¬ë§¤ì•¡ì´ ì ì€ ìˆœìœ¼ë¡œ ì¶œë ¥
select userid as 'ì‚¬ìš©ì',sum(price*amount) "ì´êµ¬ë§¤ì•¡"
from buytbl
group by userid
having sum(price*amount) >1000
order by sum(price*amount);

-- ì´í•© ë˜ëŠ” ì¤‘ê°€í•©ê³„ë¥¼ êµ¬í•˜ë ¤ë©´ group byì ˆê³¼ í•¨ê»˜ ROLLUPë¬¸ì„ í•¨ê»˜ ì‚¬ìš©í•œë‹¤.


-- GROUPNAME(ë¶„ë¥˜) ë³„ë¡œ í•©ê³„ì™€ ê·¸ ì´í•©ì„ êµ¬í•˜ê³  ì‹¶ë‹¤.
SELECT GROUPNAME FROM buytbl;

select num, groupname, sum(price*amount) as ë¹„ìš© from buytbl group by groupname, num with rollup;
-- rollup í‚¤ì›Œë“œ


/*@@@ë¡¤ì—… í‚¤ì›Œë“œ @@@
ROLLUPí•¨ìˆ˜ëŠ” ì†Œê·¸ë£¹ê°„ì˜ í•©ê³„ë¥¼ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
ROLLUPì„ ì‚¬ìš©í•˜ë©´ GROUP BYë¡œ ë¬¶ì€ ê°ê°ì˜ ì†Œê·¸ë£¹ í•©ê³„ì™€ ì „ì²´ í•©ê³„ë¥¼ ëª¨ë‘ êµ¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.


```
</div>
</details>

</div>
</details>

<details>
<summary> ğŸíŠ¸ë Œì ì…˜ ì œì–´ì–´ğŸ </summary>
<div markdown="1">

- í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ ë³€ê²½(ì…ë ¥/ìˆ˜ì •/ì‚­ì œ)í• ë•Œ ì‹¤ì œ í…Œì´ë¸”ì— ì™„ì „íˆ ì ìš©í•˜ì§€ ì•Šê³ , ì„ì‹œë¡œ ì ìš©ì‹œí‚¤ëŠ” ê²ƒ. ì‹¤ìˆ˜ê°€ ìˆì„ ê²½ìš° ì·¨ì†Œí•  ìˆ˜ ìˆë‹¤.

```SQL
-- íŠ¸ë Œì ì…˜ì œì–´ì–´ í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ ë³€ê²½(ì…ë ¥/ìˆ˜ì •/ì‚­ì œ)í• ë•Œ ì‹¤ì œ í…Œì´ë¸”ì— ì™„ì „íˆ ì ìš©í•˜ì§€ ì•Šê³ , ì„ì‹œë¡œ ì ìš©ì‹œí‚¤ëŠ” ê²ƒ. ì‹¤ìˆ˜ê°€ ìˆì„ ê²½ìš° ì·¨ì†Œí•  ìˆ˜ ìˆë‹¤.
*/
SELECT * FROM usertbl;
DESC usertbl;
INSERT INTO usertbl VALUES ('sym', 'yoomi', 2000, 'ê²½ê¸°', '010', '12345878', 170, '2024-01-17');
ROLLBACK;
DELETE FROM usertbl where userid = 'sym';
SELECT * FROM usertbl;


-- test í…Œì´ë¸” ìƒì„± @@@@@
create table testtbl(
id int,
username char(3),
age int);
insert into testtbl values(3,'ë¬¸ì„',34);
select * from testtbl;
rollback;


insert into testtbl(id,username) values(2,"kko");
insert into testtbl(username,id,age) values('jko',3,22);
select * from testtbl;



```

</div>
</details>

<details>
<summary> ğŸAutoincrementğŸ </summary>
<div markdown="1">

```SQL
-- test2í…Œì´ë¸” ìƒì„± @@@@@
create table testtbl2(
id int auto_increment primary key, username char(3), age int); -- auto_increment +1 ì”© ì¦ê°€í•´ì£¼ëŠ”ê²ƒì´ë‹¤ 
insert into testtbl2 values(null,'ì§€íš¨',25);
select * from testtbl2;
rollback;
commit; -- ì»¤ë°‹í›„ì—ëŠ” ë¡¤ë°±ì´ ë˜ì§€ ì•ŠëŠ”ë‹¤. 

select @@autocommit;
set autocommit =0;

==================================

-- autoincrement ì–´ëŠ ìˆ«ìê¹Œì§€ ì¦ê°€ë˜ì—ˆëŠ”ì§€ í™•ì¸ë°©ë²• 
select last_insert_id();
alter table testtbl2 auto_increment = 100; -- auto_increment ì…ë ¥ê°’ì„ 100ë¶€í„° ì…ë ¥ë˜ë„ë¡ ë³€ê²½í•˜ê² ë‹¤.
set @@auto_increment_increment =3;

insert into testtbl2 values(null,'oj1',5);
insert into testtbl2 values(null,'oj2',10);
select * from testtbl2;

```

</div>
</details>

<details>
<summary> ğŸUpdate,Delete,Turncate,Update setğŸ </summary>
<div markdown="1">

```SQL

-- ëŒ€ëŸ‰ì˜ ìƒ˜í”Œë°ì´í„° ìƒì„± ë°©ë²• : insert into ...select êµ¬ë¬¸ 
-- testtbl3 í…Œì´ë¸” ìƒì„±í•œ í›„ ë°ì´í„° ë°›ì•„ì˜¤ê¸° 
create table testtbl3 (
id int,
fname varchar(50),
lname varchar(50));
insert into testtbl3 select emp_no,first_name,
last_name from employees.employees;
select
 count(id) from testtbl3;
 -- 
 commit;
 
 -- testtbl4 employees.employees í…Œì´ë¸” ì†ì„±ì¤‘ emp_no, first_name, last_name í•œë²ˆì— ë°›ì•„ì˜¤ê¸° 
 create table testtbl4(select emp_no, first_name, last_name from employees.employees);
 desc testtbl4;
 
 -- ë°ì´í„°ì˜ ìˆ˜ì • : update : ê¸°ì¡´ì— ì…ë ¥ë˜ì–´ ìˆëŠ” ê°’ì„ ë³€ê²½í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” ëª…ë ¹ì–´ 
 update í…Œì´ë¸” ì´ë¦„ 
 set ì—´1 = ê°’1, ì—´2 =ê°’2
 where ì¡°ê±´; -- ìƒëµ ê°€ëŠ¥ 
 
 select * from testtbl4;
 update testtbl4
 set last_name = 'none'
 where first_name = 'kyoichi';
rollback;
 select * from testtbl4;
commit;
-- ë°ì´í„°ì˜ ì‚­ì œ : DELETE FROM í…Œì´ë¸”ì´ë¦„ WHERE ì¡°ê±´;  (íˆ¬í”Œì— ëŒ€í•œ ì‚­ì œ) // ë‹¨ìœ„ê°€ íˆ¬í”Œì´ë¼ê³ ìƒê°í•´ë¼ (í–‰,ROW,TUPLE ë‹¨ìœ„) 
SELECT last_name
from testtbl4;
delete from testtbl4 where last_name = 'lamba';
delete from testtbl4 where last_name = 'lamba' limit 5;
rollback;

-- ëŒ€ìš©ëŸ‰ í…Œì´ë¸” 3ê°œ ìƒì„± bigtbl1, bigtabl2, bigtabl3 ì„ í•˜ê³  í…Œì´ë¸”ì„ ì‚­ì œí•˜ë ¤ë©´ 
-- 3ê°œ í…Œì´ë¸” ìƒì„± 
create table bigtbl1(select emp_no,birth_date, first_name, last_name,gender,hire_date from employees.employees);
create table bigtbl2(select emp_no,birth_date, first_name, last_name,gender,hire_date from employees.employees);
create table bigtbl3(select emp_no,birth_date, first_name, last_name,gender,hire_date from employees.employees);
-- create table bigtbl1(select * from employees.employees); ì´ë ‡ê²Œ ê°€ëŠ¥ 
-- í…Œì´ë¸” ì‚­ì œ 
delete from bigtbl1; -- bigtbl1 ì „ì²´ íŠœí”Œë§Œ ì‚­ì œ 
drop table bigtbl1; -- bigtbl1 í…Œì´ë¸” ìì²´ë¥¼ ì‚­ì œ
truncate table bigtbl3; -- íŠ¸ë Œì ì…˜ ë¡œê·¸ë¥¼ ê¸°ë¡í•˜ì§€ ì•Šê³  íˆ¬í”Œë§Œ ì‚­ì œ deleteì™€ì˜ ì°¨ì´ëŠ” ì†ë„ê°€ ë” ë¹ ë¥´ë‹¤   

```


</div>
</details>

<details>
<summary> ğŸWITHì ˆ(ì¬ê·€ì CTE),ignore,ë“€í”Œë¦¬ì¼€ì´íŠ¸ğŸ </summary>
<div markdown="1">

```SQL
-- usertb1ì—ì„œ ì•„ì´ë””, ì´ë¦„, ì£¼ì†Œë§Œ ê°€ì§€ê³  ì™€ì„œ member TBL ìƒì„± í•˜ì‹œì˜¤ 3ê±´ë§Œ ê°€ì ¸ì˜¤ê¸° 
create table membertbl (select userid,name,addr from usertbl limit 3);
select * from membertbl;
ALTER TABLE memberTBL
ADD CONSTRAINT PK_MEMberTBL PRIMARY KEY (USERID);
SELECT * from MEMBERTBL;
insert into membertbl values('bbq','ë¹„ë¹„í','í•œêµ­');
insert into membertbl values('bbK','ë¹„ë¹„ì¼€ì´','í•œêµ­');
insert into membertbl values('SJH','ì„œì¥í›ˆ','ì„œìš¸');
insert into membertbl values('AJW','ì•ˆì •í™˜','ì„œìš¸');

-- ì´ê·¸ë…¸ì–´ ì¶”ì–´ ( ì´ê·¸ë…¸ì–´ë¥¼ ì“°ë©´ ì—ëŸ¬ëœ¨ê³  ë©ˆì¶”ëŠ”ê²Œ ì•„ë‹ˆë¼ ë©”ì„¸ì§€ë§Œ ì „ë‹¬í•´ì£¼ê³  ë°”ë¡œ ëª…ë ¹ë¬¸ì„ ì§„í–‰ì‹œì¼œì¤€ë‹¤.)
insert IGNORE into membertbl values('bbq','ë¹„ë¹„í1','í•œêµ­');
insert IGNORE into membertbl values('bbK','ë¹„ë¹„ì¼€ì´2','í•œêµ­');
insert IGNORE into membertbl values('SJH','ì„œì¥í›ˆ3','ì„œìš¸');
insert IGNORE into membertbl values('AJW','ì•ˆì •í™˜4','ì„œìš¸');
insert IGNORE into membertbl values('AJH','ì•ˆì •í›ˆ5','ì„œìš¸');

select * from membertbl;
-- ì—¬ê¸°ì„œ ë§Œì•½ì— ê¼­ ë„£ì–´ì•¼ í•œë‹¤ë©´ ì•„ë˜ onduplicate key update ë¥¼ ì‚¬ìš©í•´ì„œ ë„£ìœ¼ë©´ ëœë‹¤. 
-- ë§Œì•½ í”„ë¼ì´ë¨¸ë¦¬í‚¤ê°€ ì¤‘ë³µì´ ë˜ì§€ ì•Šì€ë° on duplicate key updateë¥¼ ì‚¬ìš©í•œë‹¤ë©´ insert intoì™€ ë˜‘ê°™ì€ ê¸°ëŠ¥ìœ¼ë¡œ íˆ¬í”Œë¡œ ì¸ìŠ¤í„´ìŠ¤ëœë‹¤. 
insert IGNORE into membertbl values('bbq','ë¹„ë¹„í1','í•œêµ­')
on duplicate key update name = 'ë¹„ë¹„í1', addr = 'ë¯¸êµ­';
insert IGNORE into membertbl values('bbq1','ë¹„ë¹„í1','í•œêµ­')
on duplicate key update name = 'ë¹„ë¹„í1', addr = 'ë¯¸êµ­';
insert IGNORE into membertbl values('bbK','ë¹„ë¹„ì¼€ì´2','í•œêµ­');
insert IGNORE into membertbl values('SJH','ì„œì¥í›ˆ3','ì„œìš¸');
insert IGNORE into membertbl values('AJW','ì•ˆì •í™˜4','ì„œìš¸');
insert IGNORE into membertbl values('AJH','ì•ˆì •í›ˆ5','ì„œìš¸');

select * from membertbl;

-- with ì ˆ, CTE (Common Table Expression)ë¥¼ í‘œí˜„í•˜ê¸° ìœ„í•œ êµ¬ë¬¸ MYSQLì˜  8.0 ì´í›„ ì‚¬ìš© ê°€ëŠ¥ 

-- 1. ì¬ê·€ì  CTE -> ì¬ê·€ : ë³¸ë””ì˜ ê³³ìœ¼ë¡œ ë‹¤ì‹œ ëŒì•„ì˜¤ëŠ” ê²ƒ.
/*WITH CTE_í…Œì´ë¸”ëª…(ì—´ì´ë¦„...,)
AS 
(ì¿¼ë¦¬ë¬¸) SELECT ì—´ì´ë¦„ FROM CTE_í…Œì´ë¸”ëª…;*/

-- buytbl1ì—ì„œ ì‚¬ìš©ìì•„ì´ë””ë‹¹ ì´ êµ¬ë§¤ì•¡ì„ ì¶œë ¥

 
select userid as 'ì‚¬ìš©ìë³„', sum(price*amount) as 'ì´êµ¬ë§¤ì•¡'
from buytbl group by userID;

-- ìœ„ì— ì½”ë“œë¥¼ withì ˆì„ ì‚¬ìš©í•´ì„œ ì•„ë˜ì½”ë“œë¡œ ë¦¬íŒ©í† ë§ í•  ìˆ˜ ìˆë‹¤. 

with abc(userid, total)
as (select userid, sum(price*amount)
from buytbl group by userID) select * from abc order by total desc;
/*WITH CTE_í…Œì´ë¸”ëª…(ì—´ì´ë¦„...,)
AS 
(ì¿¼ë¦¬ë¬¸) SELECT ì—´ì´ë¦„ FROM CTE_í…Œì´ë¸”ëª…;*/

-- íšŒì›í…Œì´ë¸”(usertbl)ì—ì„œ ê° ì§€ì—­ ë³„ë¡œ ê°€ì¥ í° í‚¤ë¥¼ ê°€ì§„ íšŒì›1ëª…ì„ ë½‘ì€ í›„ì— ê·¸ ì‚¬ëŒë“¤ì˜ í‰ê· ì„ ë‚´ì–´ë¼ (withì ˆì„ ì‚¬ìš©í•´ì„œ)
select * from usertbl;
select addr, max(height)
from usertbl
group by addr;

with a(addr, maxheight)
as (select addr, max(height)
from usertbl
group by addr) select avg(maxheight) as 'ê° ì§€ì—­ë³„ ìµœê³ í‚¤ì˜ í‰ê· ' from a;
```

</div>
</details>

``````